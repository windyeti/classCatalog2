{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["// //= _partials/basket.js\n// //= _partials/review.js\nfunction Container() {\n\tthis.id = '';\n\tthis.className = '';\n\tthis.htmlCode = ''\n}\nContainer.prototype.render = function() {\n\treturn this.htmlCode;\n}\n// ----------- class Good ------------------\nfunction Good( options ) {\n\tContainer.call(this);\n\n\tthis.id_product = options.id_product;\n\tthis.price = options.price;\n\tthis.name = options.name;\n\tthis.reviews = options.reviews;\n\tthis.price = options.price;\n\tthis.className = 'good';\n\tthis.htmlCode = '';\n}\nGood.prototype = Object.create(Container.prototype);\nGood.prototype.constructor = Good;\n\nGood.prototype.render = function() {\n\tvar self = this;\n\tthis.$divGood = $('<div>').attr({'id' : 'product_' + this.id_product, 'class' : 'good'});\n\tthis.$divName = $('<div>').attr({'class' : 'product_name'}).text(this.name);\n\tthis.$divPrice = $('<div>').attr({'class' : 'product_price'}).text(this.price + ' руб.');\n\n\tthis.$divName.appendTo(this.$divGood);\n\tthis.$divPrice.appendTo(this.$divGood);\n\tthis.$buttonBuy = $('<button>').attr({'class' : 'product_button_buy'}).text('Купить');\n\tthis.$buttonBuy.appendTo(this.$divGood);\n\n\tthis.renderReviews();\n\n\treturn this.$divGood;\n}\nGood.prototype.renderReviews = function() {\n\tvar self = this;\n\tthis.$divReviews = $('<div>').attr({'class' : 'product_reviews'}).text('Отзывы');\n\tthis.$divAddNewReview = $('<div>').attr({'class' : 'product_addNewReview'}).text('Добавить отзыв');\n\tthis.$divAddNewReview.appendTo(this.$divReviews);\n\t// ---- onClick -----------\n\tthis.$divAddNewReview.on('click', function() {\n\t\tself.renderModale();\n\t})\n\t// ---- end onClick -----------\n\n\t\t$(this.reviews).each(function() {\n\t\t\tvar $divReview = $('<div>').attr({'class' : 'product_review'});\n\t\t\tvar $spanSubmit = ( $('<span>').attr({'class' : 'product_submit'}).text(this.submit) );\n\t\t\tvar $spanAddPlus = ( $('<span>').attr({'class' : 'product_addPlus'}).text('+') );\n\t\t\tvar $spanDelete = ( $('<span>').attr({'class' : 'product_delete'}).text('-') );\n\t\t\tvar $spanTextAbout = ( $('<span>').attr({'class' : 'product_textAbout'}).text(this.textAbout) );\n\t\t\t$divReview\n\t\t\t\t.append($spanSubmit)\n\t\t\t\t.append($spanAddPlus)\n\t\t\t\t.append($spanDelete)\n\t\t\t\t.append($spanTextAbout);\n\t\t\t$divReview.appendTo(self.$divReviews);\n\n\t\t\t$spanDelete.on('click', this, function(e) {\n\t\t\t\tself.deleteReview( e.data );\n\t\t\t});\n\t\t\t$spanAddPlus.on('click', this, function(e) {\n\t\t\t\tself.addLike( e.data );\n\t\t\t})\n\t\t});\n\tthis.$divReviews.appendTo(this.$divGood);\n}\nGood.prototype.renderModale = function() {\n\tvar self = this;\n\tthis.$divModale = $('<div>').attr({'class':'modale'}).text('Введите текст отзыва.');\n\tthis.$formModale = $('<form>').attr({'class':'form_modale'})\n\t\t.append( $('<input>').attr({'type':'text','class':'input_modale'}) )\n\t\t.append( $('<button>').attr({'class':'button_modale'}).text('OK') );\n\n\tthis.$divModale.append( this.$formModale );\n\tthis.$divModale.appendTo( $('body') );\n\n\tthis.$divModale.on('click', '.button_modale', function(e) {\n\t\te.preventDefault();\n\t\tself.newReviewText = $(this).parent().find('.input_modale').val();\n\t\tself.addToReviews();\n\t\tself.$divModale.remove();\n\t})\n}\nGood.prototype.addToReviews = function() {\n\tthis.reviews.push({\n\t\t\t\t\tsubmit : '0',\n\t\t\t\t\ttextAbout : this.newReviewText\n\t\t\t\t});\n\tthis.cleanOldAndRenderReviews();\n}\nGood.prototype.cleanOldAndRenderReviews = function() {\n\tthis.$divReviews.remove();\n\tthis.renderReviews();\n}\nGood.prototype.addLike = function( review ) {\n\tvar newSubmit = parseInt(review.submit);\n\tnewSubmit++;\n\treview.submit = newSubmit;\n\n\tthis.cleanOldAndRenderReviews();\n}\nGood.prototype.deleteReview = function( review ) {\n\tvar self = this;\n\tvar ind;\n\t$(this.reviews).each(function(inx) {\n\t\tif(this === review) {\n\t\t\tind = inx;\n\t\t}\n\t});\n\t\n\tthis.reviews.splice(ind,1);\n\n\tthis.cleanOldAndRenderReviews();\n}\n// --------------- end class Good ---------------\n\nfunction Catalog() {\n\tContainer.call(this);\n\n\tthis.id = 'catalogGoods';\n\tthis.goodItems = [];\n\tthis.htmlCode = '';\n}\nCatalog.prototype = Object.create(Container.prototype);\nCatalog.prototype.constructor = Catalog;\n\nCatalog.prototype.getListGoods = function() {\n\t$.ajax({\n\t\turl : 'catalog.json',\n\t\tdataType : 'json',\n\t\tcontext : this,\n\t\tsuccess : function(data) {\n\t\t\tif( data.result != 1 ) {\n\t\t\t\tconsole.log('ошибка в результате');\n\t\t\t\treturn\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\t$(data.goods).each(function() {\n\t\t\t\tself.goodItems.push( new Good( this ) );\n\t\t\t});\n\t\t\tthis.render();\n\t\t}\n\t});\n}\nCatalog.prototype.render = function() {\n\tthis.htmlCode = $('div').attr({'id':this.id});\n\tvar self = this;\n\t$(this.goodItems).each(function() {\n\t\tself.htmlCode.append( this.render() );\n\t});\n}"],"file":"main.js"}