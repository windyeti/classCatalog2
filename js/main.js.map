{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["// //= _partials/basket.js\n// //= _partials/review.js\nfunction Container() {\n\tthis.id = '';\n\tthis.className = '';\n\tthis.htmlCode = ''\n}\nContainer.prototype.render = function() {\n\treturn this.htmlCode;\n}\n// // ------------- Catalog ------------------\nfunction Catalog() {\n\tContainer.call(this);\n\n\tthis.id = 'catalog';\n\tthis.className = 'catalog';\n\tthis.goodItems = [];\n\tthis.htmlCode = '';\n\n\tthis.makeGoodItems();\n}\nCatalog.prototype = Object.create(Container.prototype);\nCatalog.prototype.constructor = Catalog;\n\nCatalog.prototype.makeGoodItems = function() {\n\t$.ajax({\n\t\turl : 'catalog.json',\n\t\tdataType : 'json',\n\t\tcontext : this,\n\t\tsuccess : function(data) {\n\t\t\tif( data.result != 1 ) {\n\t\t\t\tconsole.log('ошибка в данных с сервера');\n\t\t\t\treturn\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\t$(data.goods).each(function() {\n\t\t\t\tself.goodItems.push( new Good( this ) );\n\t\t\t});\n\t\t\t$(this.goodItems).each(function() {\n\t\t\t\tthis.generateMarkup();\n\t\t\t});\n\t\t}\n\t});\n}\n\nCatalog.prototype.render = function() {\n\tthis.htmlCode = $('<div>').attr({'id':this.id});\n\tthis.htmlCode.append( $('<div>').text('Каталог') );\n\treturn this.htmlCode;\n}\n// // ----------- class Good ------------------\nfunction Good( options ) {\n\tContainer.call(this);\n\n\tthis.id = options.id_product;\n\tthis.price = options.price;\n\tthis.name = options.name;\n\tthis.objReviewsAndSubmits = new Reviews( this.id, options.reviewsAndSubmits );\n\tthis.className = 'good';\n\tthis.htmlCode = '';\n}\nGood.prototype = Object.create(Container.prototype);\nGood.prototype.constructor = Good;\n\nGood.prototype.render = function() {\n\t\tthis.htmlCode = $('<div>').attr({'id' : 'good_' + this.id, 'class' : 'good'});\n\t\tthis.htmlCode\n\t\t\t.append( $('<div>').attr({'class' : 'good_name'}).text(this.name) )\n\t\t\t.append( $('<div>').attr({'class' : 'good_price'}).text(this.price + ' руб.') )\n\t\t\t.append( $('<button>').attr({'class' : 'good_button_buy'}).text('Купить') );\n\n\treturn this.htmlCode;\n}\nGood.prototype.generateMarkup = function() {\n\t$('#catalog').append( this.render() );\n\tthis.objReviewsAndSubmits.generateMarkup();\n}\n// // --------------- end class Good ---------------\n// // ------------- class Reviews -----------------\nfunction Reviews( idProduct, list ) {\n\tContainer.call(this);\n\n\tthis.id = idProduct;\n\tthis.ArrayObjsReviewAndSubmit = this.makeArrayObjsReviewAndSubmit(list);\n\tthis.className = 'reviews';\n\tthis.htmlCode = '';\n\tthis.reviewsBlockHtmlCode = '';\n}\nReviews.prototype = Object.create(Container.prototype);\nReviews.prototype.constructor = Reviews;\n\nReviews.prototype.makeArrayObjsReviewAndSubmit = function(list) {\n\tvar result = [];\n\t$(list).each(function() {\n\t\tresult.push( new Review( this ) );\n\t});\n\treturn result\n}\nReviews.prototype.generateMarkup = function() {\n\tvar self = this;\n\tif (!this.htmlCode)\n\t\t$( '#good_' + this.id ).append( this.render() );\n\tthis.htmlCode.append( this.generateBlockReviews() );\t\n}\nReviews.prototype.generateBlockReviews = function() {\n\tif (!this.reviewsBlockHtmlCode)\n\t\tthis.reviewsBlockHtmlCode = $('<div>');\n\tvar self = this;\n\tvar result = $('<div>');\n\t$(this.ArrayObjsReviewAndSubmit).each(function() {\n\t\tthis.render().appendTo( result );\n\t});\n\tthis.reviewsBlockHtmlCode.html(result);\n\tconsole.log(this.reviewsBlockHtmlCode);\n\treturn this.reviewsBlockHtmlCode\n}\nReviews.prototype.renderModale = function() {\n\tvar self = this;\n\tvar $divModale = $('<div>').attr({'class':'modale'}).text('Введите текст отзыва.');\n\tvar $formModale = $('<form>').attr({'class':'form_modale'})\n\t\t\t.append( $('<input>').attr({'type':'text','class':'input_modale','autofocus':'autofocus'}) )\n\t\t\t.append( $('<button>').attr({'class':'button_modale'}).text('OK') );\n\n\t$divModale.append( $formModale );\n\t$divModale.appendTo( $('body') );\n\n\t$divModale.on('click', '.button_modale', function(e) {\n\t\te.preventDefault();\n\t\tself.newReviewText = $(this).parent().find('.input_modale').val();\n\t\tself.ArrayObjsReviewAndSubmit[ self.ArrayObjsReviewAndSubmit.length ] = new Review({\n\t\t\tsubmit : 0,\n\t\t\ttextAbout : self.newReviewText\n\t\t});\n\t\tself.generateBlockReviews();\n\t\t$divModale.remove();\n\t});\n}\nReviews.prototype.render = function() {\n\tvar self = this;\n\tthis.htmlCode = $('<div>').attr({'class' : this.className}).text('Отзывы');\n\tthis.htmlCode\n\t\t.append( $('<div>').attr({'class' : this.className+'_addNewReview'}).text('Добавить отзыв') );\n// ---------- on -------\n\tthis.htmlCode.on('click', '.'+this.className+'_addNewReview', function() {\n\t\tself.renderModale();\n\t});\n\n\tthis.htmlCode.on('click', '.review_addPlus', this.ArrayObjsReviewAndSubmit, function(e) {\n\t\tvar $divReview = $(e.target).parent();\n\t\tvar $divReviews = $(e.target).parent().parent();\n\t\t$divReviews.find('.review').filter(function(ind) {\n\t\t\tif ( $(this).get(0) == $divReview.get(0) ) {\n\t\t\t\te.data[ind].render('changeSubmit');\n\t\t\t\treturn\n\t\t\t}\n\t\t});\n\t});\n\n\tthis.htmlCode.on('click', '.review_delete', this, function(e) {\n\t\tvar $divReview = $(e.target).parent();\n\t\tvar $divReviews = $(e.target).parent().parent();\n\t\t$divReviews.find('.review').filter(function(ind) {\n\t\t\tif ( $(this).get(0) == $divReview.get(0) ) {\n\t\t\t\te.data.ArrayObjsReviewAndSubmit.splice([ind],1);\n\t\t\t\t// e.data.htmlCode.find('.review').remove();\n\t\t\t\te.data.generateMarkup();\n\t\t\t\treturn\n\t\t\t}\n\t\t});\n\t});\n// ---------- end on -------\n\treturn this.htmlCode;\n}\n// // // ------------- end class Reviews -----------------\n\n// // // ------------- class Reviews -----------------\nfunction Review( options ) {\n\tContainer.call(this);\n\n\tthis.submit = options.submit;\n\tthis.textAbout = options.textAbout;\n\tthis.className = 'review';\n\tthis.htmlCode = '';\n}\nReview.prototype = Object.create(Container.prototype);\nReview.prototype.constructor = Review;\n\nReview.prototype.render = function(codeAction) {\n\tif (!this.htmlCode) {\n\t\tthis.htmlCode = $('<div>').attr({'class' : this.className});\n\t\tthis.$spanSubmit = $('<span>').attr({'class' : this.className+'_submit'}).text(this.submit);\n\t\tthis.$spanAddPlus = $('<span>').attr({'class' : this.className+'_addPlus'}).text('+');\n\t\tthis.$spanDelete = $('<span>').attr({'class' : this.className+'_delete'}).text('-');\n\t\tthis.$spanTextAbout = $('<span>').attr({'class' : this.className+'_textAbout'}).text(this.textAbout);\n\t\tthis.htmlCode\n\t\t\t.append(this.$spanSubmit)\n\t\t\t.append(this.$spanAddPlus)\n\t\t\t.append(this.$spanDelete)\n\t\t\t.append(this.$spanTextAbout);\n\t} else if ( codeAction == 'changeSubmit' ) {\n\t\tvar submitNum = this.$spanSubmit.text();\n\t\tsubmitNum++;\n\t\tthis.$spanSubmit.text( submitNum );\n\t}\n\t\treturn this.htmlCode;\n}\t\n// // // ------------- end class Reviews -----------------"],"file":"main.js"}